function[DataOutWithMins] = WriteDataFile(out,OutList,ins,mins,FName,SeqLength,NumPos,SubjID,OutFile)ReactThresh = 0.25;ShowThresh = 0.75;MissThresh=1;OldOutInd=[];for i=1:mins    MinIns=ins(1+(i-1)*SeqLength:i*SeqLength);    MinOutList=OutList(1+(i-1)*NumPos:i*NumPos);    OutTimes=ins(MinOutList);    CutOff=ins(i*SeqLength);    EndInds=find((out>=CutOff+ReactThresh)&(out<CutOff+ShowThresh));    if(i==mins)        OutInd=find(out<=CutOff+MissThresh);    elseif((MinOutList(end)==SeqLength*i)&(isempty(EndInds)))        OutInd=find(out<=CutOff+MissThresh);    else        OutInd=find(out<CutOff+ShowThresh);    end    OutInd=setdiff(OutInd,OldOutInd);    MinOuts=out(OutInd);    OldOutInd=[OldOutInd,OutInd];     DataOut(i,:)=WriteMinuteData(MinOuts,OutTimes,MinIns,ReactThresh,ShowThresh,MissThresh);endDataOutWithMins=[[1:mins]' DataOut];WriteIndividualFile(DataOutWithMins,FName);WriteWholeFile(DataOut',SubjID,OutFile)function WriteIndividualFile(DataOut,FName);fid=fopen(FName,'w');fprintf(fid,'%% Minute\tHits\tMisses\tMean RT\tStandard Deviation\n');fprintf(fid,'%d   \t%d   \t%d   \t%1.4f   \t%1.4f\n',DataOut');fclose(fid);function WriteWholeFile(DataOut,SubjID,OutFile)if(~isfile(OutFile))     fid=fopen(OutFile,'w');    fprintf(fid,'SubjectID\t');    for i=1:6        str=['Hits' int2str(i)];        fprintf(fid,'%s\t',str);     end    for i=1:6        str=['Misses' int2str(i)];        fprintf(fid,'%s\t',str);     end    for i=1:6        str=['MeanRT' int2str(i)];        fprintf(fid,'%s\t',str);     end    fprintf(fid,'\n');    fclose(fid);    endfid=fopen(OutFile,'a');fprintf(fid,'%s\t',SubjID);for i=1:size(DataOut,2) fprintf(fid,'%d\t',DataOut(1,i)); end;for i=1:size(DataOut,2) fprintf(fid,'%d\t',DataOut(2,i)); end;for i=1:size(DataOut,2) fprintf(fid,'%d\t',DataOut(3,i)); end; fprintf(fid,'\n');fclose(fid);function[DataOut] = WriteMinuteData(out,OutTimes,ins,ReactThresh,ShowThresh,MissThresh)Misses=0;HitTimes=[];AlreadyHit=zeros(size(OutTimes));for i=1:length(out)    TimeDiffs=out(i)-OutTimes;    PosTimeDiffs=TimeDiffs(find(TimeDiffs>=ReactThresh));    if(isempty(PosTimeDiffs))        Misses=Misses+1;    else               [MinReactTime,ind]=min(PosTimeDiffs);        if(MinReactTime>MissThresh)            Misses=Misses+1;        elseif(AlreadyHit(ind)==0)            HitTimes=[HitTimes MinReactTime];            AlreadyHit(ind)=1;        elseif((MinReactTime>ShowThresh)&(AlreadyHit(ind)>0))            AlreadyHit(ind)=AlreadyHit(ind)+1;            Misses=Misses+1;        end    endendHits=length(HitTimes);if(Hits==0)    MeanHTime=0;    SDHTime=0;else    MeanHTime=mean(HitTimes);    SDHTime=std(HitTimes);endDataOut=[Hits Misses MeanHTime SDHTime];