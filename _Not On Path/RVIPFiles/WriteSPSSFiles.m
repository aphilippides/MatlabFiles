function WriteSPSSFilesflag=1;while(flag)    s=input('Enter number of minutes per trial and press return\n(default=6: just press return)\n');    flag=0;    if(isempty(s)) NumMins=6;    elseif(isnumeric(s)) NumMins=floor(s);    else flag=1;    endendFList=GetFileNameList;if(FList==-1)   return; end;cd('Macintosh HD:Desktop Folder:Miscellaneous:RVIPFiles:RVIPData');f=input('Enter filename\n','s');filename1 = [f '.sav']filename2 = [f '.xls']while(IsFile(filename1))    a=input('Filename in use. Do you want to over write [y/n]\n','s');    if((a=='y')|(a=='Y')) break;     else         f=input('Enter new filename\n','s');        filename1 = [f '.sav']        filename2 = [f '.xls']    endend;fid1=fopen(filename1,'w');fid2=fopen(filename2,'w');WritePreamble(NumMins,fid2);for i=1:size(FList,1)    fn=deblank(FList(i,:));    [a,b]=Get2RTNums(fn);    [c,d]=Get2SartNums(fn);    fprintf(fid1,'%s\t',fn);    fprintf(fid2,'%s\t',fn);        if(isempty(a))        for j=1:NumMins           fprintf(fid1,' \t');          fprintf(fid2,' \t');        end    else        for j=1:NumMins           fprintf(fid1,'%d\t',a(j));           fprintf(fid2,'%d\t',a(j));        end    end    if(isempty(b))        for j=1:NumMins           fprintf(fid1,' \t');          fprintf(fid2,' \t');        end    else        for j=1:NumMins           fprintf(fid1,'%d\t',b(j));           fprintf(fid2,'%d\t',b(j));        end    end    if(isempty(a))        for j=1:NumMins           fprintf(fid1,' \t');          fprintf(fid2,' \t');        end    else        for j=1:NumMins           fprintf(fid1,'%d\t',a(j+NumMins));           fprintf(fid2,'%d\t',a(j+NumMins));        end    end    if(isempty(b))        for j=1:NumMins           fprintf(fid1,' \t');          fprintf(fid2,' \t');        end    else        for j=1:NumMins           fprintf(fid1,'%d\t',b(j+NumMins));           fprintf(fid2,'%d\t',b(j+NumMins));        end    end        if(isempty(a))        for j=1:NumMins           fprintf(fid1,' \t');          fprintf(fid2,' \t');        end    else        for j=1:NumMins           fprintf(fid1,'%1.4f\t',a(j+2*NumMins));           fprintf(fid2,'%1.4f\t',a(j+2*NumMins));        end    end    if(isempty(b))        for j=1:NumMins           fprintf(fid1,' \t');          fprintf(fid2,' \t');        end    else        for j=1:NumMins           fprintf(fid1,'%1.4f\t',b(j+2*NumMins));           fprintf(fid2,'%1.4f\t',b(j+2*NumMins));        end    end        if(isempty(c))        fprintf(fid1,' \t \t \t \t \t \t');        fprintf(fid2,' \t \t \t \t \t \t');     else        fprintf(fid1,'%d\t%d\t%d\t%d\t%d\t%d\t',c); 		 fprintf(fid2,'%d\t%d\t%d\t%d\t%d\t%d\t',c);     end    if(isempty(d))               fprintf(fid1,' \t \t \t \t \t \t');        fprintf(fid2,' \t \t \t \t \t \t');     else        fprintf(fid1,'%d\t%d\t%d\t%d\t%d\t%d\n',d); 		 fprintf(fid2,'%d\t%d\t%d\t%d\t%d\t%d\n',d);     endendfclose(fid1);fclose(fid2);function[FList]=GetFileNameListcd('Macintosh HD:Desktop Folder:Miscellaneous:RVIPFiles:RVIPData:Selected');ls *.dat;[o,fns]=IsFile('*.dat');if(isempty(fns))     a=input('No data files in this directory. Press return to exit');    FList=-1;    return;endflag=1;while(flag)    a=input('\nSelect files which will NOT be included in SPSS file: two options.\n1. Type the name of the file without the ''.dat'' extension followed by enter.\n2. If you want both trials to be removed type the subject reference only,\nfollowed by enter\nType enter on its own to continue\n','s');     if(isempty(a)) break; end    [fns,in] = DeleteFileIsFile(fns,[a '.dat']);    if(~in)        fns=DeleteFileIsFile(fns,[a '1.dat']);        fns=DeleteFileIsFile(fns,[a '2.dat']);     end     fprintf('\n\nFiles selected are:\n\n')     L=size(fns,1);     N=fix(L/10)-1;     M=rem(L,10);     for i=0:N        for j=1:10           fprintf('%s ',fns(i*10+j,:));        end        fprintf('\n');     end     for i=1:M         fprintf('%s ',fns((N+1)*10+i,:));     end     fprintf('\n');endFList=[];for i=1:size(fns,1)    nstr=GetBitB4Num(fns(i,:));    flag=0;    for j=1:size(FList,1)         if (strcmp(deblank(FList(j,:)),nstr))            flag=1;            break;        end    end    if(flag==0) FList=strvcat(FList,nstr); endend[Ns,is]=sort(str2num(FList));FList=FList(is,:);function[a,b]=Get2RTNums(fn)%cd('C:\Documents and Settings\administrator\My Documents\Documents\Jenny\RVIPData\Selected');cd('C:\My Documents\RVIPData\Selected');name=[fn '1.dat'];a=GetRTNums(name);name=[fn '2.dat'];b=GetRTNums(name);function[n]=GetRTNums(fn)if(IsFile(fn))    h=load(fn,'-ascii')';    n=[h(2,:) h(3,:) h(4,:)];else    n=[];endfunction[a,b]=Get2SartNums(fn)%cd('C:\Documents and Settings\administrator\My Documents\Documents\Jenny\STATS');cd('C:\CRX\DIGIT\STATS');name=[fn '1.txt'];a=GetSartNums(name);name=[fn '2.txt'];b=GetSartNums(name);function[n]=GetSartNums(fn)fid =fopen(fn); if(fid==-1) n=[];else    for i=1:10        tline = fgetl(fid);        if ~ischar(tline), break, end;        n(i)=GetNumbers(tline,i);    end    fclose(fid);endfunction[val]=GetNumbers(str,lnum)if(lnum==6) val=GetNum(str,15);else val=GetNum(str);endfunction[val,i]= GetNum(lstr,lstart)if(nargin<2) lstart=1; end;for i=lstart:length(lstr)    if(IsIntStr(lstr(i)))NStart = i ; break; end;endfor j=i+1:length(lstr)    if(lstr(j)~='i')        val=str2num(lstr(j));        if(isempty(val)) NEnd = j-1 ; break; end;    else        NEnd=j-1;    endendif (j==length(lstr)) NEnd=j; endval = str2num(lstr(NStart:NEnd));function[str,i]= GetBitB4Num(lstr,lstart)l=deblank(lstr);if(nargin<2) lstart=5; end;i=length(l)-lstart;str=lstr(1:i);function[str,i]= GetBitB4NumOld(lstr,lstart)if(nargin<2) lstart=1; end;for i=lstart:length(lstr)    if(~isletter(lstr(i))) NStart = i ; break; end;endfor j=i+1:length(lstr)    if(lstr(j)~='i')        val=str2num(lstr(j));        if(isempty(val)) NStart = j-1 ; break; end;    else        NStart=j-1;    endendif (j==length(lstr)) NStart=j+1; endstr = lstr(lstart:NStart-1);function WritePreamble(NumMins,fid)%fprintf(fid,'subno\tfilename\t ');fprintf(fid,'subno\t');for i=1:NumMins fprintf(fid,'rvip1%dh\t',i); endfor i=1:NumMins fprintf(fid,'rvip2%dh\t',i); endfor i=1:NumMins fprintf(fid,'rvip1%dm\t',i); endfor i=1:NumMins fprintf(fid,'rvip2%dm\t',i); endfor i=1:NumMins fprintf(fid,'rvip1%drt\t',i); endfor i=1:NumMins fprintf(fid,'rvip2%drt\t',i); endfprintf(fid,'sart1ce\t');fprintf(fid,'sart1oe\t');fprintf(fid,'sart1crt\t');fprintf(fid,'sart1pre\t');fprintf(fid,'sart1pos\t');fprintf(fid,'sart1critRT\t');fprintf(fid,'sart2ce\t');    fprintf(fid,'sart2oe\t');    fprintf(fid,'sart2crt\t');    fprintf(fid,'sart2pre\t');    fprintf(fid,'sart2pos\t');    fprintf(fid,'sart2critRT\n');    